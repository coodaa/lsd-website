---
import "../styles/global.css";
const { pages = [], activeSlug } = Astro.props;

// ðŸ‘‰ Nur Hauptseiten (ohne Eltern) anzeigen
let filteredPages = pages
  .filter((p) => p.parent === 0)
  .sort((a, b) => {
    const orderA = a.menu_order ?? 0;
    const orderB = b.menu_order ?? 0;
    return orderA - orderB;
  });

// ðŸ‘‰ Impressum & Datenschutz nach unten verschieben
const footerPages = filteredPages.filter(
  (p) =>
    p.title.rendered.toLowerCase().includes("impressum") ||
    p.title.rendered.toLowerCase().includes("datenschutz")
);

// Entferne sie aus der Hauptliste
filteredPages = filteredPages.filter((p) => !footerPages.includes(p));
---

<aside class="sidebar">
  <!-- ðŸ”˜ Mobile MenÃ¼ Button -->
  <button class="menu-toggle" id="menuToggle" aria-label="MenÃ¼ Ã¶ffnen">
    <span class="menu-label">
      <span class="menu-text">MenÃ¼</span>
      <span class="menu-close">X</span>
    </span>
  </button>

  <!-- ðŸ”— HauptmenÃ¼ -->
  <ul id="menuList">
    {filteredPages.map((p) => (
      <li class={p.slug === activeSlug ? "active" : ""}>
        <a href={`/${p.slug}`} class={p.slug === activeSlug ? "active" : ""}>
          {p.title.rendered}
        </a>
      </li>
    ))}

    <!-- ðŸ“± Mobile Footer -->
    <div class="mobile-footer">
      {footerPages.map((p, i) => (
        <>
          <a href={`/${p.slug}`}>{p.title.rendered}</a>
          {i < footerPages.length - 1 && <span class="dot">Â·</span>}
        </>
      ))}
    </div>
  </ul>

  <!-- ðŸ’» Desktop Footer -->
  <div class="sidebar-footer" id="sidebarFooter">
    {footerPages.map((p, i) => (
      <>
        <a href={`/${p.slug}`}>{p.title.rendered}</a>
        {i < footerPages.length - 1 && <span class="dot">Â·</span>}
      </>
    ))}
  </div>

  <!-- ðŸ§  Script fÃ¼r das mobile MenÃ¼ -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("menuToggle");
      const list = document.getElementById("menuList");
      const body = document.body;
      if (btn && list) {
        btn.addEventListener("click", () => {
          const isOpen = list.classList.toggle("open");
          btn.classList.toggle("open", isOpen);
          btn.setAttribute(
            "aria-label",
            isOpen ? "MenÃ¼ schlieÃŸen" : "MenÃ¼ Ã¶ffnen"
          );
          body.style.overflow = isOpen ? "hidden" : "";
          body.style.height = isOpen ? "100vh" : "";
        });
      }
    });
  </script>
</aside>
