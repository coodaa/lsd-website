---
import { fix, splitMenuTitle } from "./utils/fix.js";
const { pages = [], activeSlug = "", footerPages = [] } = Astro.props;
---

<div class="sidebar">
  <button
    class="menu-toggle"
    id="menuToggle"
    type="button"
    aria-label="Toggle menu"
    aria-expanded="false"
    aria-controls="menuList"
  >
    <span class="toggle-text">Menu</span>
    <span class="toggle-close">X</span>
  </button>

  <nav id="menuList" aria-label="Main navigation">
    <ul class="menu">
      {
        pages.map((p) => {
          const { bullet, text } = splitMenuTitle(p.title?.rendered || "");
          const isActive = !!activeSlug && p.slug === activeSlug;

          return (
            <li class={`menu-item ${isActive ? "active" : ""}`}>
              <a href={`/${p.slug}`} class="menu-link">
                {bullet && <span class="menu-bullet">{bullet}&nbsp;</span>}
                <span class="menu-label">{text}</span>
              </a>
            </li>
          );
        })
      }
    </ul>

    <div class="mobile-footer-links">
      {
        footerPages.map((p, i) => (
          <>
            <a href={`/${p.slug}`}>{fix(p.title?.rendered || "")}</a>
            {i < footerPages.length - 1 && <span class="dot">·</span>}
          </>
        ))
      }
    </div>
  </nav>

  <footer class="desktop-footer" aria-label="Footer navigation">
    {
      footerPages.map((p, i) => (
        <>
          <a href={`/${p.slug}`}>{fix(p.title?.rendered || "")}</a>
          {i < footerPages.length - 1 && <span class="dot">·</span>}
        </>
      ))
    }
  </footer>
</div>

<script>
  const root = document.currentScript?.closest(".sidebar");
  const toggle = root?.querySelector("#menuToggle");
  const menu = root?.querySelector("#menuList");

  function closeMenu() {
    toggle?.classList.remove("open");
    menu?.classList.remove("open");
    toggle?.setAttribute("aria-expanded", "false");
  }

  toggle?.addEventListener("click", () => {
    toggle.classList.toggle("open");
    menu?.classList.toggle("open");
    toggle.setAttribute(
      "aria-expanded",
      toggle.classList.contains("open") ? "true" : "false",
    );
  });

  menu?.addEventListener("click", (e) => {
    const a = e.target?.closest?.("a");
    if (a && menu.classList.contains("open")) closeMenu();
  });
</script>
