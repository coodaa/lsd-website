---
import { fix, splitMenuTitle } from "./utils/fix.js";
const { pages = [], activeSlug = "", footerPages = [] } = Astro.props;
---

<div class="sidebar">
  <!-- Mobile Toggle -->
  <button
    class="menu-toggle"
    id="menuToggle"
    type="button"
    aria-label="Toggle menu"
  >
    <span class="toggle-text">Menu</span>
    <span class="toggle-close">X</span>
  </button>

  <!-- Mobile + Desktop Menu -->
  <nav id="menuList" aria-label="Main navigation">
    <ul class="menu">
      {
        pages.map((p) => {
          const { bullet, text } = splitMenuTitle(p.title?.rendered || "");
          const isActive = !!activeSlug && p.slug === activeSlug;

          return (
            <li class={`menu-item ${isActive ? "active" : ""}`}>
              <a href={`/${p.slug}`} class="menu-link">
                {bullet && <span class="menu-bullet">{bullet}&nbsp;</span>}
                <span class="menu-label">{text}</span>
              </a>
            </li>
          );
        })
      }
    </ul>

    <!-- MOBILE: Impressum + Datenschutz unten -->
    <div class="mobile-footer-links">
      {
        footerPages.map((p, i) => (
          <>
            <a href={`/${p.slug}`}>{fix(p.title?.rendered || "")}</a>
            {i < footerPages.length - 1 && <span class="dot">Â·</span>}
          </>
        ))
      }
    </div>
  </nav>
</div>

<script>
  const toggle = document.getElementById("menuToggle");
  const menu = document.getElementById("menuList");

  toggle?.addEventListener("click", () => {
    toggle.classList.toggle("open");
    menu.classList.toggle("open");
  });
</script>
