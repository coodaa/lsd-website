---
import "../styles/global.css";
const { pages = [], activeSlug } = Astro.props;

let filteredPages = pages
  .filter((p) => p.parent === 0)
  .sort((a, b) => (a.menu_order ?? 0) - (b.menu_order ?? 0));

const footerPages = filteredPages.filter(
  (p) =>
    p.title.rendered.toLowerCase().includes("impressum") ||
    p.title.rendered.toLowerCase().includes("datenschutz")
);

filteredPages = filteredPages.filter((p) => !footerPages.includes(p));
---

<aside class="sidebar">
  <button class="menu-toggle" id="menuToggle" aria-label="Menü öffnen">
    <span class="menu-label">
      <span class="menu-text">Menü</span>
      <span class="menu-close">X</span>
    </span>
  </button>

  <ul id="menuList">
    {
      filteredPages.map((p) => (
        <li class={p.slug === activeSlug ? "active" : ""}>
          <a href={`/${p.slug}`} class={p.slug === activeSlug ? "active" : ""}>
            <span set:html={p.title.rendered} />
          </a>
        </li>
      ))
    }

    <div class="mobile-footer">
      {
        footerPages.map((p, i) => (
          <>
            <a href={`/${p.slug}`}>
              <span set:html={p.title.rendered} />
            </a>
            {i < footerPages.length - 1 && <span class="dot">·</span>}
          </>
        ))
      }
    </div>
  </ul>

  <div class="sidebar-footer" id="sidebarFooter">
    {
      footerPages.map((p, i) => (
        <>
          <a href={`/${p.slug}`}>
            <span set:html={p.title.rendered} />
          </a>
          {i < footerPages.length - 1 && <span class="dot">·</span>}
        </>
      ))
    }
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const btn = document.getElementById("menuToggle");
      const list = document.getElementById("menuList");
      const body = document.body;

      if (btn && list) {
        btn.addEventListener("click", () => {
          const isOpen = list.classList.toggle("open");
          btn.classList.toggle("open", isOpen);
          body.style.overflow = isOpen ? "hidden" : "";
          body.style.height = isOpen ? "100vh" : "";
        });
      }
    });
  </script>
</aside>
