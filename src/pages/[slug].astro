---
import Layout from "../layouts/Layout.astro";
import Sidebar from "../components/Sidebar.astro";

export const prerender = false;

export async function getStaticPaths() {
  return [];
}

// Nutzt dynamisch die API-URL aus .env
const apiBase = import.meta.env.WP_API;

// Slug aus der URL holen
const slug = Astro.params.slug;

// Seite anhand des Slugs abrufen
let page = null;
try {
  const res = await fetch(`${apiBase}/pages?slug=${slug}`);
  if (res.ok) {
    const data = await res.json();
    page = data[0];
  }
} catch (err) {
  console.error("❌ Fehler beim Laden der Seite:", err);
}

// Alle Seiten fürs Menü (geordnet nach Reihenfolge)
let pages = [];
try {
  const resPages = await fetch(`${apiBase}/pages?per_page=100&orderby=menu_order&order=asc`);
  if (resPages.ok) pages = await resPages.json();
} catch (err) {
  console.error("❌ Fehler beim Laden der Seitenliste:", err);
}
---

<Layout
  title={page?.yoast_head_json?.title || page?.title?.rendered || "LSD Berlin"}
  description={page?.yoast_head_json?.description || "Love, Sex & Dreams – LSD Berlin"}
>
  <div class="grid-layout">
    <Sidebar pages={pages} activeSlug={slug} />

    <div class="content-area">
      <p class="hint">Klick mich ↓</p>
      <div class="content" set:html={page?.content?.rendered}></div>
    </div>
  </div>
</Layout>
