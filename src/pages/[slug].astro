---
import Layout from "../layouts/Layout.astro";
import Sidebar from "../components/Sidebar.astro";

export const prerender = false;

export async function getStaticPaths() {
  return [];
}

const baseUrl = "https://lsd-backend.de/wp-json/wp/v2";
const slug = Astro.params?.slug;

// Seite laden
const res = await fetch(`${baseUrl}/pages?slug=${slug}`);
const data = await res.json();
const page = data?.[0];

// Alle Seiten fürs Menü
let pages = [];
try {
  const resPages = await fetch(`${baseUrl}/pages?per_page=100&orderby=menu_order&order=asc`);
  if (resPages.ok) pages = await resPages.json();
} catch (err) {
  console.error("Fehler beim Laden der Seiten:", err);
}
---

<Layout
  title={page?.yoast_head_json?.title || page?.title?.rendered || "LSD Berlin"}
  description={page?.yoast_head_json?.description || "Love, Sex & Dreams – LSD Berlin"}
>
  <div class="grid-layout">
    <Sidebar pages={pages} activeSlug={slug} />

    <div class="content-area">
      <p class="hint">Klick mich ↓</p>
      <div class="content" set:html={page?.content?.rendered}></div>
    </div>
  </div>
</Layout>
