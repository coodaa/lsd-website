---
import Sidebar from "../components/Sidebar.astro";
import ContentView from "../components/ContentView.astro";
import "../styles/global.css";

const baseUrl = import.meta.env.WP_API;

// WordPress-Daten laden (ohne export)
let pages = [];
let page = null;

try {
  const res = await fetch(`${baseUrl}/pages`);
  if (res.ok) {
    pages = await res.json();
    if (pages.length > 0) {
      page = pages[0];
    }
  } else {
    console.error("WP API returned:", res.status);
  }
} catch (err) {
  console.error("Error fetching WP pages:", err);
}
---
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <title>LSD Berlin</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body>
    {page ? (
      <>
        <Sidebar pages={pages} activeSlug={page.slug} />
        <ContentView page={page} />
      </>
    ) : (
      <p style="padding:2rem;color:red">
        Keine Inhalte gefunden. Bitte prÃ¼fe deine WordPress-Verbindung ({baseUrl}/pages).
      </p>
    )}
  </body>
</html>
